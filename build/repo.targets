<Project>

  <PropertyGroup>
    <PrepareDependsOn Condition="'$(UsePrebuiltPackageCache)'=='true'">$(PrepareDependsOn);UpdateNuGetConfig</PrepareDependsOn>
    <MusicStoreE2ETestProject>$(RepositoryRoot)test\MusicStore.E2ETests\MusicStore.E2ETests.csproj</MusicStoreE2ETestProject>
  </PropertyGroup>

  <Target Name="UpdateNuGetConfig">
    <UpdatePackageSource
      NuGetConfigPath="$(RepositoryRoot)NuGet.config"
      SourceName="Dependencies"
      SourceUri="$(DependencyBuildDirectory)"
      Condition="Exists('$(DependencyBuildDirectory)')" />
  </Target>

  <Target Name="_FilterTestProjects" BeforeTargets="TestProjects" 
  Condition="'$(VSTestTestCaseFilter)'=='E2Etests=NanoServer' Or '$(VSTestTestCaseFilter)'=='smoketests=packagecache'">
    <ItemGroup>
      <ProjectsToTest Remove="@(ProjectsToTest)" />
      <ProjectsToTest Include="$(MusicStoreE2ETestProject)" />
    </ItemGroup>

    <Error Text="Could not find test projects to run" Condition="@(ProjectsToTest->Count()) == 0" />
  </Target>
</Project>
